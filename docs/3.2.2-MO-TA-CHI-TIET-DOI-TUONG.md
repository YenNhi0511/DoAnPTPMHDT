# 3.2.2. MÔ TẢ CHI TIẾT CÁC ĐỐI TƯỢNG

## BẢNG TỔNG HỢP CÁC LỚP ĐỐI TƯỢNG VÀ QUAN HỆ

| STT | Tên lớp (Class)          | Vai trò trong hệ thống                                  | Quan hệ với lớp khác                                                                                                         |
| --- | ------------------------ | ------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| 1   | User                     | Quản lý thông tin người dùng, xác thực và phân quyền    | **1-1** với UserProfile (optional); **1-N** với OTPVerification, Application, Job, InterviewPanel                            |
| 2   | OTPVerification          | Quản lý mã OTP cho xác thực 2FA và reset mật khẩu       | **N-1** với User                                                                                                             |
| 3   | UserProfile              | Lưu trữ thông tin chi tiết và mở rộng của người dùng    | **1-1** với User                                                                                                             |
| 4   | JWTToken                 | Quản lý JSON Web Token cho phiên đăng nhập              | Được tạo bởi User khi đăng nhập thành công                                                                                   |
| 5   | AuthenticationController | Xử lý logic xác thực: đăng ký, đăng nhập, quên mật khẩu | Tương tác với User, OTPVerification, JWTToken; Gọi EmailService, RedisService                                                |
| 6   | Job                      | Quản lý thông tin tin tuyển dụng                        | **N-1** với User (Recruiter), Company; **1-N** với Application                                                               |
| 7   | Company                  | Quản lý thông tin công ty đăng tin tuyển dụng           | **1-N** với Job                                                                                                              |
| 8   | JobController            | Quản lý CRUD operations cho tin tuyển dụng              | Tương tác với Job, Company, Application; Gọi EmailService, SearchIndexService, AnalyticsService                              |
| 9   | Application              | Quản lý hồ sơ ứng tuyển của ứng viên                    | **N-1** với User (Candidate), Job; **1-1** với AIAnalysis; **1-N** với Interview; **1-1** với RecruitmentResult              |
| 10  | AIAnalysis               | Lưu kết quả phân tích CV bằng Google Gemini AI          | **1-1** với Application                                                                                                      |
| 11  | AIAnalysisController     | Xử lý logic phân tích CV bằng AI                        | Tương tác với Application, AIAnalysis, Job, CVFile; Gọi GeminiAPIService, CVParserService, EmailService, CeleryTaskQueue     |
| 12  | Interview                | Quản lý thông tin lịch phỏng vấn                        | **N-1** với Application; **N-M** với User (Interviewers) qua InterviewPanel                                                  |
| 13  | InterviewController      | Quản lý lịch phỏng vấn: tạo, hủy, reschedule            | Tương tác với Interview, Application, InterviewPanel, User; Gọi VideoConferenceService, CalendarIntegration, EmailService    |
| 14  | RecruitmentResult        | Quản lý quyết định tuyển dụng cuối cùng                 | **1-1** với Application; **N-1** với User (HR Manager)                                                                       |
| 15  | AnalyticsController      | Tạo báo cáo và dashboard analytics                      | Tương tác với Job, Application, AIAnalysis, Interview, RecruitmentResult; Gọi ReportGeneratorService, DataAggregationService |

### Chú giải quan hệ:

- **1-1**: Quan hệ một-một (mỗi đối tượng A liên kết với tối đa một đối tượng B)
- **1-N**: Quan hệ một-nhiều (một đối tượng A liên kết với nhiều đối tượng B)
- **N-1**: Quan hệ nhiều-một (nhiều đối tượng A liên kết với một đối tượng B)
- **N-M**: Quan hệ nhiều-nhiều (nhiều đối tượng A liên kết với nhiều đối tượng B)

### Phân loại theo Module:

**Module 1 - Authentication & User Management:** User, OTPVerification, UserProfile, JWTToken, AuthenticationController

**Module 2 - Job Management:** Job, Company, JobController

**Module 3 - Application & AI Screening:** Application, AIAnalysis, AIAnalysisController

**Module 4 - Interview Management:** Interview, InterviewController

**Module 5 - Decision & Analytics:** RecruitmentResult, AnalyticsController

---

## PHẦN I: MODULE 1 - AUTHENTICATION & USER MANAGEMENT

---

### 1. USER (Người Dùng)

**Loại**: Entity (Thực thể)  
**Mô tả**: Lớp trung tâm của toàn bộ hệ thống, đại diện cho tất cả người dùng trong hệ thống tuyển dụng.

#### Thuộc Tính

| STT | Thuộc Tính            | Kiểu Dữ Liệu | Mô Tả                 | Ràng Buộc                                |
| --- | --------------------- | ------------ | --------------------- | ---------------------------------------- |
| 1   | id                    | UUID         | Mã định danh duy nhất | Primary Key, Auto-generated              |
| 2   | email                 | String(255)  | Email đăng nhập       | Unique, Not Null, Valid email format     |
| 3   | password_hash         | String(255)  | Mật khẩu đã mã hóa    | Not Null, Bcrypt hashed                  |
| 4   | full_name             | String(100)  | Họ và tên đầy đủ      | Not Null                                 |
| 5   | phone_number          | String(20)   | Số điện thoại         | Valid phone format                       |
| 6   | role                  | Enum         | Vai trò người dùng    | CANDIDATE, RECRUITER, INTERVIEWER, ADMIN |
| 7   | is_active             | Boolean      | Trạng thái kích hoạt  | Default: True                            |
| 8   | is_verified           | Boolean      | Đã xác thực email     | Default: False                           |
| 9   | created_at            | DateTime     | Thời gian đăng ký     | Auto timestamp                           |
| 10  | last_login            | DateTime     | Lần đăng nhập cuối    | Nullable                                 |
| 11  | failed_login_attempts | Integer      | Số lần đăng nhập sai  | Default: 0, Max: 5                       |
| 12  | locked_until          | DateTime     | Thời điểm mở khóa     | Nullable, Auto unlock after 30 mins      |

#### Quan Hệ

- **1-1** với UserProfile (optional): `user.profile`
- **1-N** với OTPVerification: `user.otp_codes`
- **1-N** với Application (nếu là Candidate): `user.applications`
- **1-N** với Job (nếu là Recruiter): `user.posted_jobs`
- **1-N** với InterviewPanel (nếu là Interviewer): `user.interview_panels`

#### Business Rules

1. **Tự động khóa**: Sau 5 lần đăng nhập sai liên tiếp, tài khoản tự động khóa 30 phút
2. **Email duy nhất**: Không cho phép 2 user có cùng email
3. **Role restrictions**:
   - CANDIDATE: Chỉ xem và nộp hồ sơ
   - RECRUITER: Đăng tin, xem hồ sơ ứng tuyển
   - INTERVIEWER: Xem lịch phỏng vấn, đánh giá
   - ADMIN: Full quyền quản trị
4. **Xác thực bắt buộc**: Phải verify email trước khi sử dụng đầy đủ chức năng

---

### 2. OTPVERIFICATION (Xác Thực OTP)

**Loại**: Entity (Thực thể)  
**Mô tả**: Quản lý mã OTP cho xác thực 2 yếu tố và reset mật khẩu.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính | Kiểu Dữ Liệu | Mô Tả             | Ràng Buộc                    |
| --- | ---------- | ------------ | ----------------- | ---------------------------- |
| 1   | id         | UUID         | Mã định danh      | Primary Key                  |
| 2   | user_id    | UUID         | Người dùng        | Foreign Key → User           |
| 3   | otp_code   | String(6)    | Mã OTP 6 chữ số   | Not Null, Numeric            |
| 4   | otp_type   | Enum         | Loại OTP          | REGISTRATION, PASSWORD_RESET |
| 5   | created_at | DateTime     | Thời gian tạo     | Auto timestamp               |
| 6   | expires_at | DateTime     | Thời gian hết hạn | created_at + 10 minutes      |
| 7   | is_used    | Boolean      | Đã sử dụng        | Default: False               |
| 8   | attempts   | Integer      | Số lần thử        | Default: 0, Max: 5           |

#### Quan Hệ

- **N-1** với User: `otp.user`

#### Business Rules

1. **1 user chỉ 1 OTP active**: Khi tạo OTP mới, tự động vô hiệu hóa các OTP cũ cùng type
2. **Thời hạn 10 phút**: OTP hết hiệu lực sau 10 phút kể từ khi tạo
3. **Tối đa 5 lần thử**: Sau 5 lần nhập sai, OTP bị khóa, phải tạo mới
4. **Một lần sử dụng**: OTP chỉ dùng được 1 lần, sau đó tự động vô hiệu hóa

---

### 3. USERPROFILE (Hồ Sơ Người Dùng)

**Loại**: Entity (Thực thể)  
**Mô tả**: Lưu trữ thông tin chi tiết và mở rộng của người dùng.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính   | Kiểu Dữ Liệu | Mô Tả                   | Ràng Buộc                  |
| --- | ------------ | ------------ | ----------------------- | -------------------------- |
| 1   | id           | UUID         | Mã hồ sơ                | Primary Key                |
| 2   | user_id      | UUID         | Người dùng              | Foreign Key → User, Unique |
| 3   | avatar_url   | String(500)  | Đường dẫn ảnh đại diện  | Nullable, URL format       |
| 4   | address      | String(255)  | Địa chỉ chi tiết        | Nullable                   |
| 5   | city         | String(100)  | Thành phố               | Nullable                   |
| 6   | country      | String(100)  | Quốc gia                | Default: "Vietnam"         |
| 7   | bio          | Text         | Tiểu sử / Giới thiệu    | Max 1000 chars             |
| 8   | company_name | String(200)  | Tên công ty (Recruiter) | Nullable                   |
| 9   | company_logo | String(500)  | Logo công ty            | Nullable, URL format       |
| 10  | website      | String(255)  | Website cá nhân/công ty | Nullable, URL format       |
| 11  | updated_at   | DateTime     | Lần cập nhật cuối       | Auto timestamp             |

#### Quan Hệ

- **1-1** với User: `profile.user`

#### Business Rules

1. **1-1 với User**: Mỗi User chỉ có 1 Profile
2. **Avatar size**: Tối đa 5MB, tự động resize về 400x400
3. **Recruiter bắt buộc company_name**: Nếu role là RECRUITER, company_name không được null
4. **Bio giới hạn**: Tối đa 1000 ký tự để đảm bảo hiển thị tốt

---

### 4. JWTTOKEN (Token Xác Thực)

**Loại**: Entity (Thực thể)  
**Mô tả**: Quản lý JSON Web Token cho phiên đăng nhập.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính    | Kiểu Dữ Liệu | Mô Tả                    | Ràng Buộc                          |
| --- | ------------- | ------------ | ------------------------ | ---------------------------------- |
| 1   | access_token  | String(500)  | Token truy cập           | JWT format, 15 mins expiry         |
| 2   | refresh_token | String(500)  | Token làm mới            | JWT format, 7 days expiry          |
| 3   | token_type    | String(20)   | Loại token               | Default: "Bearer"                  |
| 4   | expires_in    | Integer      | Thời gian hết hạn (giây) | 900 for access, 604800 for refresh |

#### Quan Hệ

- Được tạo bởi User khi đăng nhập thành công

#### Business Rules

1. **Short-lived Access Token**: 15 phút để giảm rủi ro bị đánh cắp
2. **Long-lived Refresh Token**: 7 ngày để UX tốt hơn
3. **Secure Storage**: Access token trong localStorage, Refresh token trong httpOnly cookie
4. **Token Rotation**: Mỗi lần refresh, tạo cả access và refresh token mới

---

### 5. AUTHENTICATIONCONTROLLER (Điều Khiển Xác Thực)

**Loại**: Control (Điều khiển)  
**Mô tả**: Xử lý toàn bộ logic xác thực, đăng ký, đăng nhập, quên mật khẩu.

#### Quan Hệ

- Tương tác với User, OTPVerification, JWTToken
- Gọi EmailService, RedisService

#### Business Rules

1. **Rate Limiting**: Login max 5 attempts/15 phút/IP; OTP request max 3 lần/giờ/user
2. **Password Policy**: Min 8 ký tự, mix uppercase, lowercase, numbers, special chars
3. **Session Management**: Token blacklist với Redis, auto logout sau 7 ngày không hoạt động
4. **Security**: Không thông báo nếu email không tồn tại (tránh email enumeration)
5. **Audit Log**: Log tất cả authentication events

---

## PHẦN II: MODULE 2 - JOB MANAGEMENT

---

### 6. JOB (Tin Tuyển Dụng)

**Loại**: Entity (Thực thể)  
**Mô tả**: Lớp core đại diện cho một tin tuyển dụng trong hệ thống.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính        | Kiểu Dữ Liệu  | Mô Tả              | Ràng Buộc                                |
| --- | ----------------- | ------------- | ------------------ | ---------------------------------------- |
| 1   | id                | UUID          | Mã tin tuyển dụng  | Primary Key                              |
| 2   | recruiter_id      | UUID          | Nhà tuyển dụng     | Foreign Key → User                       |
| 3   | company_id        | UUID          | Công ty            | Foreign Key → Company                    |
| 4   | title             | String(200)   | Tiêu đề tin        | Not Null, Index                          |
| 5   | description       | Text          | Mô tả công việc    | Not Null, Full-text search               |
| 6   | requirements      | Text          | Yêu cầu ứng viên   | Not Null                                 |
| 7   | min_salary        | Decimal(12,2) | Lương tối thiểu    | >= 0, Nullable                           |
| 8   | max_salary        | Decimal(12,2) | Lương tối đa       | >= min_salary, Nullable                  |
| 9   | currency          | String(3)     | Đơn vị tiền tệ     | VND, USD, EUR                            |
| 10  | location          | String(255)   | Địa điểm làm việc  | Not Null                                 |
| 11  | job_type          | Enum          | Loại công việc     | FULL_TIME, PART_TIME, REMOTE, INTERNSHIP |
| 12  | status            | Enum          | Trạng thái         | DRAFT, OPEN, CLOSED                      |
| 13  | positions         | Integer       | Số lượng cần tuyển | Default: 1, >= 1                         |
| 14  | deadline          | Date          | Hạn nộp hồ sơ      | >= current_date                          |
| 15  | created_at        | DateTime      | Ngày đăng          | Auto timestamp                           |
| 16  | updated_at        | DateTime      | Ngày cập nhật      | Auto timestamp                           |
| 17  | view_count        | Integer       | Số lượt xem        | Default: 0                               |
| 18  | application_count | Integer       | Số hồ sơ ứng tuyển | Default: 0                               |

#### Quan Hệ

- **N-1** với User (Recruiter): `job.recruiter`
- **N-1** với Company: `job.company`
- **1-N** với Application: `job.applications`

#### Business Rules

1. **Auto-close**: Job tự động chuyển status = CLOSED khi deadline qua (Celery scheduled task)
2. **Salary validation**: max_salary >= min_salary (nếu có)
3. **Edit restrictions**: Không cho edit khi có >= 5 applications (chỉ có thể close)
4. **Delete restrictions**: Không cho delete khi có applications
5. **View tracking**: Không đếm view của chính recruiter đăng tin

---

### 7. COMPANY (Công Ty)

**Loại**: Entity (Thực thể)  
**Mô tả**: Thông tin công ty đăng tin tuyển dụng.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính   | Kiểu Dữ Liệu | Mô Tả              | Ràng Buộc                   |
| --- | ------------ | ------------ | ------------------ | --------------------------- |
| 1   | id           | UUID         | Mã công ty         | Primary Key                 |
| 2   | name         | String(200)  | Tên công ty        | Not Null, Unique            |
| 3   | logo_url     | String(500)  | Logo công ty       | Nullable, URL               |
| 4   | description  | Text         | Giới thiệu công ty | Nullable                    |
| 5   | website      | String(255)  | Website            | Nullable, URL               |
| 6   | industry     | String(100)  | Ngành nghề         | Not Null                    |
| 7   | company_size | Enum         | Quy mô             | 1-50, 51-200, 201-500, 500+ |
| 8   | founded_year | Integer      | Năm thành lập      | >= 1900                     |
| 9   | address      | String(255)  | Địa chỉ            | Not Null                    |
| 10  | city         | String(100)  | Thành phố          | Not Null                    |
| 11  | country      | String(100)  | Quốc gia           | Default: "Vietnam"          |

#### Quan Hệ

- **1-N** với Job: `company.jobs`

#### Business Rules

1. **Unique name**: Tên công ty là duy nhất trong hệ thống
2. **Verification**: Công ty cần được xác minh trước khi đăng tin (optional)
3. **Profile completeness**: Khuyến khích hoàn thiện đầy đủ thông tin (logo, description, website)

---

### 8. JOBCONTROLLER (Điều Khiển Tin Tuyển Dụng)

**Loại**: Control (Điều khiển)  
**Mô tả**: Quản lý CRUD operations cho Job.

#### Quan Hệ

- Tương tác với Job, Company, Application
- Gọi EmailService, SearchIndexService, AnalyticsService

#### Business Rules

1. **Authorization**: Chỉ RECRUITER hoặc ADMIN được tạo/sửa/xóa job
2. **Ownership**: Chỉ owner hoặc ADMIN được update/delete job của mình
3. **Edit restrictions**: Nếu có applications, chỉ cho update deadline, status, description (minor changes)
4. **Delete restrictions**: Không cho xóa nếu có applications (application_count > 0)
5. **Status transitions**: DRAFT→OPEN, OPEN→CLOSED, DRAFT→CLOSED (valid flows)
6. **View tracking**: Tăng view_count khi user xem (trừ owner), track analytics

---

## PHẦN III: MODULE 3 - APPLICATION & AI SCREENING

---

### 9. APPLICATION (Hồ Sơ Ứng Tuyển)

**Loại**: Entity (Thực thể)  
**Mô tả**: Đại diện cho một hồ sơ ứng tuyển của ứng viên cho một tin tuyển dụng.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính   | Kiểu Dữ Liệu | Mô Tả             | Ràng Buộc                                                                                               |
| --- | ------------ | ------------ | ----------------- | ------------------------------------------------------------------------------------------------------- |
| 1   | id           | UUID         | Mã hồ sơ          | Primary Key                                                                                             |
| 2   | candidate_id | UUID         | Ứng viên          | Foreign Key → User                                                                                      |
| 3   | job_id       | UUID         | Tin tuyển dụng    | Foreign Key → Job                                                                                       |
| 4   | cv_file_id   | UUID         | File CV           | Foreign Key → CVFile                                                                                    |
| 5   | cover_letter | Text         | Thư xin việc      | Max 2000 chars                                                                                          |
| 6   | status       | Enum         | Trạng thái        | SUBMITTED, AI_SCREENING, SCREENING_PASSED, SCREENING_FAILED, INTERVIEWING, OFFERED, REJECTED, WITHDRAWN |
| 7   | submitted_at | DateTime     | Thời gian nộp     | Auto timestamp                                                                                          |
| 8   | updated_at   | DateTime     | Lần cập nhật cuối | Auto timestamp                                                                                          |
| 9   | ai_analyzed  | Boolean      | Đã phân tích AI   | Default: False                                                                                          |
| 10  | ai_score     | Decimal(5,2) | Điểm AI           | 0-100, Nullable                                                                                         |

#### Quan Hệ

- **N-1** với User (Candidate): `application.candidate`
- **N-1** với Job: `application.job`
- **1-1** với AIAnalysis: `application.ai_analysis`
- **1-N** với Interview: `application.interviews`

#### Business Rules

1. **Unique constraint**: 1 candidate chỉ nộp 1 hồ sơ cho 1 job
2. **Auto AI screening**: Sau khi submit, tự động trigger AI analysis (Celery task)
3. **Immutable after interview**: Không cho withdraw sau khi đã có interview
4. **Notification**: Gửi email mỗi khi status thay đổi

---

### 10. AIANALYSIS (Phân Tích AI)

**Loại**: Entity (Thực thể)  
**Mô tả**: Lưu kết quả phân tích CV bằng Google Gemini AI.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính       | Kiểu Dữ Liệu | Mô Tả               | Ràng Buộc                                                      |
| --- | ---------------- | ------------ | ------------------- | -------------------------------------------------------------- |
| 1   | id               | UUID         | Mã phân tích        | Primary Key                                                    |
| 2   | application_id   | UUID         | Hồ sơ ứng tuyển     | Foreign Key → Application, Unique                              |
| 3   | overall_score    | Decimal(5,2) | Điểm tổng thể       | 0-100                                                          |
| 4   | skills_score     | Decimal(5,2) | Điểm kỹ năng        | 0-100                                                          |
| 5   | experience_score | Decimal(5,2) | Điểm kinh nghiệm    | 0-100                                                          |
| 6   | education_score  | Decimal(5,2) | Điểm học vấn        | 0-100                                                          |
| 7   | jd_match_score   | Decimal(5,2) | Điểm khớp JD        | 0-100                                                          |
| 8   | strengths        | JSON         | Điểm mạnh           | Array of strings                                               |
| 9   | weaknesses       | JSON         | Điểm yếu            | Array of strings                                               |
| 10  | recommendation   | Enum         | Khuyến nghị         | STRONG_MATCH, GOOD_MATCH, MODERATE_MATCH, WEAK_MATCH, NO_MATCH |
| 11  | reasoning        | Text         | Lý do đánh giá      | Max 1000 chars                                                 |
| 12  | analyzed_at      | DateTime     | Thời gian phân tích | Auto timestamp                                                 |
| 13  | model_version    | String(50)   | Version Gemini      | Ex: "gemini-1.5-pro"                                           |

#### Quan Hệ

- **1-1** với Application: `ai_analysis.application`

#### Business Rules

1. **Scoring formula**: overall_score = skills(35%) + experience(25%) + education(15%) + jd_match(25%)
2. **Interview threshold**: overall_score >= 60 VÀ recommendation in [STRONG_MATCH, GOOD_MATCH]
3. **Auto status update**: Application.status = SCREENING_PASSED nếu >= 60, SCREENING_FAILED nếu < 60
4. **Model tracking**: Lưu model_version để audit và so sánh kết quả giữa các versions

---

### 11. AIANALYSISCONTROLLER (Điều Khiển Phân Tích AI)

**Loại**: Control (Điều khiển)  
**Mô tả**: Xử lý logic phân tích CV bằng Gemini AI.

#### Quan Hệ

- Tương tác với Application, AIAnalysis, Job, CVFile
- Gọi GeminiAPIService, CVParserService, EmailService, CeleryTaskQueue

#### Business Rules

1. **Asynchronous processing**: CV analysis chạy background bằng Celery task
2. **Error handling**: Retry 3 lần với exponential backoff (5s, 30s, 120s)
3. **Auto status update**: Application.status = SCREENING_PASSED (score >= 60) hoặc SCREENING_FAILED (score < 60)
4. **Authorization**: Chỉ Recruiter của job hoặc Admin được reanalyze và compare candidates
5. **Model config**: Gemini 1.5 Pro, Temperature 0.3, Max tokens 2048
6. **Notification**: Gửi email cho recruiter sau khi analysis xong

---

## PHẦN IV: MODULE 4 - INTERVIEW MANAGEMENT

---

### 12. INTERVIEW (Lịch Phỏng Vấn)

**Loại**: Entity (Thực thể)  
**Mô tả**: Đại diện cho một buổi phỏng vấn.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính     | Kiểu Dữ Liệu | Mô Tả              | Ràng Buộc                                    |
| --- | -------------- | ------------ | ------------------ | -------------------------------------------- |
| 1   | id             | UUID         | Mã phỏng vấn       | Primary Key                                  |
| 2   | application_id | UUID         | Hồ sơ ứng tuyển    | Foreign Key → Application                    |
| 3   | round          | Integer      | Vòng phỏng vấn     | 1, 2, 3, or FINAL                            |
| 4   | interview_type | Enum         | Loại phỏng vấn     | PHONE, VIDEO, ONSITE                         |
| 5   | start_time     | DateTime     | Thời gian bắt đầu  | Not Null                                     |
| 6   | end_time       | DateTime     | Thời gian kết thúc | > start_time                                 |
| 7   | location       | String(255)  | Địa điểm           | Nullable (required for ONSITE)               |
| 8   | video_link     | String(500)  | Link video call    | Nullable (required for VIDEO)                |
| 9   | status         | Enum         | Trạng thái         | SCHEDULED, COMPLETED, CANCELLED, RESCHEDULED |
| 10  | notes          | Text         | Ghi chú            | Nullable                                     |
| 11  | created_at     | DateTime     | Thời gian tạo      | Auto timestamp                               |

#### Quan Hệ

- **N-1** với Application: `interview.application`
- **N-M** với User (Interviewers) qua InterviewPanel: `interview.interviewers`

#### Business Rules

1. **Advance booking**: Phỏng vấn phải được đặt trước tối thiểu 2 giờ
2. **Cancel/Reschedule rule**: Chỉ hủy/đổi lịch nếu còn > 2 giờ trước start_time
3. **Conflict check**: Kiểm tra xung đột lịch với interviewers trước khi tạo/reschedule
4. **Auto notification**: Gửi email/calendar invite cho candidate và interviewers
5. **Video link generation**: Tự động tạo video link cho interview type = VIDEO
6. **Status tracking**: Log tất cả status changes (SCHEDULED → COMPLETED/CANCELLED/RESCHEDULED)

---

### 13. INTERVIEWCONTROLLER (Điều Khiển Phỏng Vấn)

**Loại**: Control (Điều khiển)  
**Mô tả**: Quản lý lịch phỏng vấn.

#### Quan Hệ

- Tương tác với Interview, Application, InterviewPanel, User
- Gọi VideoConferenceService, CalendarIntegration, EmailService

#### Business Rules

1. **Authorization**: Chỉ Recruiter của job hoặc Admin được tạo/quản lý interview
2. **Validation rules**: start_time > now + 2 giờ; Application.status = SCREENING_PASSED hoặc INTERVIEWING
3. **Conflict detection**: Kiểm tra xung đột lịch với interviewers trước khi tạo interview
4. **Auto services**: Tự động tạo video link (VIDEO), calendar event, gửi email invitation
5. **Status update**: Application.status → INTERVIEWING khi tạo interview đầu tiên
6. **Calendar view**: Hiển thị lịch phỏng vấn theo role (Candidate/Interviewer/Recruiter)

---

## PHẦN V: MODULE 5 - DECISION & ANALYTICS

---

### 14. RECRUITMENTRESULT (Kết Quả Tuyển Dụng)

**Loại**: Entity (Thực thể)  
**Mô tả**: Quyết định tuyển dụng cuối cùng cho một ứng viên.

#### Thuộc Tính Chi Tiết

| STT | Thuộc Tính         | Kiểu Dữ Liệu | Mô Tả            | Ràng Buộc                          |
| --- | ------------------ | ------------ | ---------------- | ---------------------------------- |
| 1   | id                 | UUID         | Mã kết quả       | Primary Key                        |
| 2   | application_id     | UUID         | Hồ sơ ứng tuyển  | Foreign Key → Application, Unique  |
| 3   | decision           | Enum         | Quyết định       | HIRED, REJECTED, WAITLIST          |
| 4   | decided_by         | UUID         | Người quyết định | Foreign Key → User (HR Manager)    |
| 5   | reason             | Text         | Lý do quyết định | Max 1000 chars                     |
| 6   | decided_at         | DateTime     | Ngày quyết định  | Auto timestamp                     |
| 7   | internal_notes     | Text         | Ghi chú nội bộ   | Nullable, không show cho candidate |
| 8   | notified_candidate | Boolean      | Đã thông báo     | Default: False                     |

#### Quan Hệ

- **1-1** với Application: `recruitment_result.application`
- **N-1** với User (HR Manager): `recruitment_result.decided_by`

#### Business Rules

1. **Authorization**: Chỉ HR Manager hoặc Admin có quyền tạo/sửa
2. **Immutable after 48h + Offer sent**: Không thể đổi quyết định sau khi gửi offer
3. **Auto notification**: Sau khi quyết định, tự động gửi email trong 1 giờ

---

### 15. ANALYTICSCONTROLLER (Điều Khiển Phân Tích)

**Loại**: Control (Điều khiển)  
**Mô tả**: Tạo báo cáo và dashboard analytics.

#### Quan Hệ

- Tương tác với Job, Application, AIAnalysis, Interview, RecruitmentResult
- Gọi ReportGeneratorService, DataAggregationService

#### Business Rules

1. **Dashboard metrics**: Overview (total/active jobs, applications, pending review), Funnel (conversion rates), Top jobs, Time to hire
2. **Recruitment report**: PDF bao gồm job summary, applications, AI screening, interviews, final outcome, time/cost per hire
3. **Time to hire**: Average days từ application.submitted_at đến recruitment_result.decided_at (chỉ tính HIRED)
4. **Source effectiveness**: Analyze application count, conversion rate, average AI score per source
5. **Authorization**: Recruiter xem data của mình, Admin xem toàn bộ
6. **Date range filtering**: Support custom date ranges cho tất cả reports

---

## TÓM TẮT

Tài liệu đã mô tả chi tiết **15 đối tượng quan trọng nhất** trong hệ thống theo 4 nội dung chính:

### Cấu trúc mô tả mỗi đối tượng:

1. **Loại và Mô tả** (2 dòng đầu)
2. **Thuộc Tính Chi Tiết** (bảng với STT, Tên, Kiểu dữ liệu, Mô tả, Ràng buộc)
3. **Quan Hệ** (relationships với các đối tượng khác)
4. **Business Rules** (quy tắc nghiệp vụ và validation)

### Danh sách 15 đối tượng:

**Module 1 - Authentication & User Management (5 đối tượng)**

1. User - Quản lý người dùng và xác thực
2. OTPVerification - Mã OTP cho xác thực 2FA
3. UserProfile - Hồ sơ chi tiết người dùng
4. JWTToken - Token JWT cho phiên đăng nhập
5. AuthenticationController - Logic xác thực

**Module 2 - Job Management (3 đối tượng)** 6. Job - Tin tuyển dụng 7. Company - Thông tin công ty 8. JobController - Quản lý tin tuyển dụng

**Module 3 - Application & AI Screening (3 đối tượng)** 9. Application - Hồ sơ ứng tuyển 10. AIAnalysis - Phân tích AI 11. AIAnalysisController - Logic phân tích AI

**Module 4 - Interview Management (2 đối tượng)** 12. Interview - Lịch phỏng vấn 13. InterviewController - Quản lý phỏng vấn

**Module 5 - Decision & Analytics (2 đối tượng)** 14. RecruitmentResult - Quyết định tuyển dụng 15. AnalyticsController - Báo cáo & phân tích
